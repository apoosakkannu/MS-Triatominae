---
title: "alphadiversity_analyses"
author: "Anbu Poosakkannu"
date: "3/5/2020"
output: html_document
---

```{r}

#load the required libraries for the analyses

library(microbiomeSeq); packageVersion("microbiomeSeq") #need for diversity analyses
library(ggplot2); packageVersion("ggplot2") #need for plotting graphs




```


```{r}
#upload the input files for analyses

#Read the OTU file
abund_table<-read.csv("D:/Czech/triatomine_manuscript/MS-Triatominae/data/Originaldata_negative/otu_norarefaction_decontam_negative_abund.csv",row.names=1,check.names=FALSE)#change path for your computer

#transpose the OTU abundance data to have sample names on rows
abund_table<-t(abund_table)

#Read in the complete meta data file
meta_table<-read.csv("D:/Czech/triatomine_manuscript/MS-Triatominae/data/Originaldata_negative/fullmeta_negative_28022020.csv",row.names=1,check.names=FALSE)#change path for your computer

#Read the taxonomy
OTU_taxonomy<-read.csv("D:/Czech/triatomine_manuscript/MS-Triatominae/data/Originaldata_negative/otu_norarefaction_decontam_negative_taxa.csv",row.names=1,check.names=FALSE)#change path for your computer

#colnames(meta_table)<-c("ReadCount", "Plate", "WellPosition", "Organism", "State",
 #                       "Tcruzi","Host_Taxa", "Instar", "Instar_range", "Sex", "Locality",
  #                      "Nest", "Latitude", "Longitude", "Sample")




```


```{r}
###Phyloseq adaptation + cleanup
#Convert the data to phyloseq format
OTU = otu_table(as.matrix(abund_table), taxa_are_rows = FALSE)
TAX = tax_table(as.matrix(OTU_taxonomy))
SAM = sample_data(meta_table)
physeq<-merge_phyloseq(phyloseq(OTU, TAX),SAM)

clean_data<-physeq





```


```{r}
##Diversity analyses 

### Species-specific ontogeny
Rubida <- clean_data %>% subset_samples(Host_Taxa == "Trubida")
r1 <-plot_anova_diversity(Rubida, method = c("richness", "shannon"), 
                          grouping_column = "Instar", pValueCutoff = 0.05)
print(r1)

protracta <- clean_data %>% subset_samples(Host_Taxa == "Tprotracta")
r2 <- plot_anova_diversity(protracta, method = c("richness", "shannon"), 
                           grouping_column = "Instar", pValueCutoff = 0.05)
print(r2)

gerst <- clean_data %>%  subset_samples(Host_Taxa == "Tgerstaeckeri")
r3 <- plot_anova_diversity(gerst, method = c("richness", "shannon"), 
                           grouping_column = "Instar", pValueCutoff = 0.05)
print(r3)

lect <- clean_data %>% subset_samples(Host_Taxa == "Tlecticularia")
r4 <- plot_anova_diversity(lect, method = c("richness", "shannon"),
                           grouping_column = "Instar", pValueCutoff = 0.05)
print(r4)

sang <- clean_data %>% subset_samples(Host_Taxa == "Tsanguisuga")
r5 <- plot_anova_diversity(sang, method = c("richness", "shannon"),
                           grouping_column = "Instar", pValueCutoff = 0.1)
print(r5)





```

